# 抖音视频筛选与飞书保存Chrome扩展PRD

## 项目概述
开发一个Chrome浏览器扩展，用于在抖音网页版博主主页上筛选点赞数超过特定阈值的视频，并将这些视频的信息（标题、链接、点赞数）保存到飞书多维表格中。

## 技术要求
1. 使用Chrome扩展Manifest V3规范
2. 使用Service Worker而非Background Pages
3. 使用侧边栏(Side Panel)作为主要界面
4. 遵循最小权限原则设计Content Scripts
5. 实现响应式设计，确保在不同分辨率下的良好体验

## 核心功能需求

### 1. 视频筛选功能
- 在抖音博主主页上自动识别所有视频元素
- 提取每个视频的标题、链接和点赞数
- 根据用户设定的点赞数阈值（默认1000）筛选视频
- 支持多种点赞数格式解析：纯数字、带逗号的数字、带单位的数字（如"1.2万"）
- 实现多级选择器策略，确保在页面结构变化时仍能正确识别视频
- 添加严格的验证机制，防止非视频内容被误识别

### 2. 飞书保存功能
- 将筛选出的视频信息保存到指定的飞书多维表格
- 使用飞书开放API进行数据传输
- 支持批量保存多个视频记录
- 处理各种错误情况，并提供友好的错误提示
- 链接字段必须使用对象格式，包含text和link属性，而不是直接的URL字符串

### 3. 用户界面
- 使用Chrome侧边栏展示操作界面
- 提供点赞阈值设置输入框
- 显示筛选结果列表，包括视频标题、链接和点赞数
- 提供"筛选视频"和"保存到飞书"按钮
- 添加调试信息区域，可展开/折叠
- 实现友好的加载状态和错误提示

### 4. 调试与日志
- 实现详细的日志记录系统
- 记录所有关键操作和错误信息
- 在侧边栏提供日志查看功能
- 支持日志清除功能
- 添加视频详情查看功能

## 技术实现细节

### 视频识别策略
1. 使用多级CSS选择器定位视频元素
2. 当主选择器失效时，使用备用选择器
3. 实现通用选择器作为最后的备选方案
4. 对识别到的元素进行严格验证

### 视频链接提取方法
1. 使用多种CSS选择器定位视频链接元素
2. 从视频卡片中的a标签直接提取href属性
3. 从元素的各种属性中提取视频ID
4. 分析元素的HTML内容，提取可能包含的视频ID
5. 从链接中提取视频ID，构建标准视频链接
6. 将相对路径转换为绝对路径
7. 验证提取的链接是否为有效的视频链接
8. 添加完善的错误处理机制

### 飞书API集成
- APP ID: cli_a75819e2b1***
- App Secret: 5ubGZcOle862eyDy8NwTocM***
- Base ID: DukNb9B6vaDO99s3EOEczT***
- Table ID: tbl7kb3lnxqtWv***

表格字段配置：
1. 标题（文本类型）
2. 链接（超链接类型）- 必须使用对象格式，包含text和link属性
3. 点赞数（数字类型）

## 文件结构
1. `manifest.json` - 扩展配置文件
2. `background.js` - 后台服务工作线程
3. `content.js` - 内容脚本，负责页面分析和视频提取
4. `sidepanel.html` - 侧边栏HTML界面
5. `sidepanel.js` - 侧边栏交互逻辑
6. `images/` - 图标和资源文件夹

## 已知问题和解决方案
1. 抖音页面使用懒加载，需要提示用户滚动页面加载更多视频
2. 视频链接格式多样，需要使用多种方法提取
3. 飞书API要求链接字段必须是对象格式，不能是纯字符串
4. 页面结构可能变化，需要使用多级选择器策略

## 测试要点
1. 在不同博主主页测试视频识别准确性
2. 测试各种点赞数格式的解析
3. 测试飞书API集成和数据保存
4. 测试错误处理和用户提示
5. 测试在不同Chrome版本上的兼容性

## 用户体验要求
1. 操作简单直观，最少的点击次数
2. 提供清晰的操作反馈和状态提示
3. 错误信息友好且有解决建议
4. 支持查看详细调试信息，方便排查问题

## 安全和隐私
1. 只在抖音网站上运行内容脚本
2. 不收集用户个人信息
3. 只在用户明确操作时才发送数据到飞书
4. 使用HTTPS进行所有API通信

请根据以上PRD开发一个完整的Chrome扩展程序，确保代码质量高、注释清晰，并能够稳定运行。
